<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>Hello World</title>
  <script src="https://unpkg.com/react@latest/dist/react.js"></script>
  <script src="https://unpkg.com/react-dom@latest/dist/react-dom.js"></script>
  <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
  <!-- BS4 -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
  <!-- react addon -->
  <script type="text/javascript" src="https://npmcdn.com/react@15/dist/react-with-addons.js"></script>
  <!-- reactstrap -->
  <script type="text/javascript" src="https://unpkg.com/reactstrap/dist/reactstrap.min.js"></script>
</head>

<body>
  <div id="root"></div>
<script type="text/babel">
    // for reactstrap
    const {
      Table,
      Container,
      Button,
      ButtonDropdown,
      ButtonGroup,
      ButtonToolbar,
      Dropdown,
      DropdownItem,
      DropdownMenu,
      DropdownToggle,
      TetherContent,
      Tooltip,
      Col,Row
    } = Reactstrap;

    const proxyUrl ='https://cors-anywhere.herokuapp.com/'; 

    class App extends React.Component{ 
      constructor(props){
        super(props);
        this.state={
          USD:{
            buy:0,
            sell:0,
            avg:0
          },
          RMB:{
            buy:0,
            sell:0,
            avg:0
          }
        };
        this.proxyUrl =proxyUrl; 
        this.url='http://asper-bot-rates.appspot.com/currency.json';
      }

      componentDidMount() {
        this.bankid=setInterval(()=>this.startBank(),1000);
      }


      componentWillUnmount(){
        clearInterval(this.bankid);
      }

    
      startBank(){ 
        fetch(this.proxyUrl +this.url)
        .then(response=>{ 
          if(response.ok){ 
          return response.json(); 
          } 
          throw new Error('Request failed!'); 
        },networkError=>console.log(networkError.message) )
        .then(jsonResponse=>{ 
          console.log(jsonResponse); 
          console.log(Number(jsonResponse.date))

          this.setState(()=>{
            return {
              USD:{
                buy:jsonResponse.rates.USD.buyCash,
                sell:jsonResponse.rates.USD.sellCash,
                avg:(Number(jsonResponse.rates.USD.buyCash)+Number(jsonResponse.rates.USD.sellCash))/2
              },
              RMB:{
                buy:jsonResponse.rates.CNY.buyCash,
                sell:jsonResponse.rates.CNY.sellCash,
                avg:(Number(jsonResponse.rates.CNY.buyCash)+Number(jsonResponse.rates.CNY.sellCash))/2
              }
            };
          });
        }) 
    }


      render(){
      return (
        <div>
          <Row>
            <Col md="2">
              <Table bordered size="sm">
                <thead className="thead-default">
                  <tr>
                    <th scope="col"><center>匯率</center></th>
                    <th scope="col"><center>幣種</center></th>
                    <th scope="col"><center>Qty</center></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>台銀均價</td>
                    <td>BTC</td>
                    <td>1</td>
                  </tr>
                </tbody>
              </Table>
            </Col>
          </Row>  
          <Row>
            <Col md="5">
              <HuobiApi RMB={this.state.RMB}/>
            </Col>
            <Col md="4">
              <Table bordered size="sm">
                <thead className="thead-default">
                  <tr>
                    <th scope="col" colSpan="7" ><center>出金</center></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th scope="row">交易所</th>
                    <th scope="row">Qty</th>
                    <th scope="row">賣價</th>
                    <th scope="row">匯率</th>
                    <th scope="row">NTD</th>
                    <th scope="row">RMB</th>
                    <th scope="row">USD</th>
                  </tr>
                  <MaicoinApi />
                  <BitoexApi />
                  <CexioApi USD={this.state.USD}/>
                </tbody>
              </Table>
            </Col>
            <Col md="3">
              <Table bordered size="sm">
                <thead className="thead-default">
                  <tr>
                    <th scope="col" colSpan="2"><center>損益試算</center></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th scope="col">獲利</th>
                    <th scope="col">獲利率</th>
                  </tr>
                  <tr>
                    <td>4420</td>
                    <td>3.52％</td>
                  </tr>
                  <tr>
                    <td>-1102</td>
                    <td>-0.88％</td>
                  </tr>
                  <tr>
                    <td>7520</td>
                    <td>5.99％</td>
                  </tr>
                </tbody>
              </Table>
            </Col>
          </Row>
          <Row>
            <Col md="3">
              <Table bordered size="sm">
                <thead className="thead-default">
                  <tr>
                    <th  scope="col" colSpan="4"><center>現金匯率</center></th>
                  </tr>
                </thead>
                <Bank USD={this.state.USD} RMB={this.state.RMB}/>
              </Table>
            </Col>
          </Row>
          </div>
    ); } } 

    class Bank extends React.Component{
      constructor(props){
        super(props);
      }


      render(){
        return(
          <tbody>
                  <tr>
                    <th></th>
                    <th scope="col">銀行買價</th>
                    <th scope="col">銀行賣價</th>
                    <th scope="col">買賣均價</th>
                  </tr>
                  <tr>
                    <th scope="row">RMB</th>
                    <td style={{color:'#596043',fontWeight:'bold'}}>{this.props.RMB.buy}</td>
                    <td style={{color:'#596043',fontWeight:'bold'}}>{this.props.RMB.sell}</td>
                    <td style={{color:'#596043',fontWeight:'bold'}}>{(Number(this.props.RMB.buy)+Number(this.props.RMB.sell))/2}</td>
                  </tr>
                  <tr>
                    <th scope="row">USD</th>
                    <td style={{color:'#596043',fontWeight:'bold'}}>{this.props.USD.buy}</td>
                    <td style={{color:'#596043',fontWeight:'bold'}}>{this.props.USD.sell}</td>
                    <td style={{color:'#596043',fontWeight:'bold'}}>{(Number(this.props.USD.buy)+Number(this.props.USD.sell))/2}</td>
                  </tr>
                  <tr>
                    <th scope="row">自訂匯率</th>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                  </tr>
                  <tr>
                    <th scope="row">USD</th>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                  </tr>
                  <tr>
                    <th scope="row">RMB</th>
                    <td>0</td>
                    <td>0</td>
                    <td>0</td>
                  </tr>
                </tbody>        
        );
      }
    }


    class HuobiApi extends React.Component{
      constructor(props){
        super(props);
        this.state={
          BT:{
            buy:0,
            sell:0,
          },
          RMB:{
            buy:0,
            sell:0
          }
        }
        this.proxyUrl =proxyUrl; 
        this.url = 'http://api.huobi.com/staticmarket/ticker_btc_json.js';
      }

      componentDidMount() {
        this.btcid=setInterval(()=>this.startBTC(),1000);
      }

      componentWillUnmount(){
        clearInterval(this.btcid);
      }

      startBTC(){ 
          fetch(this.proxyUrl +this.url)
          .then(response=>{ 
            if(response.ok){ 
            return response.json(); 
            } 
            throw new Error('Request failed!'); 
          },networkError=>console.log(networkError.message) )
          .then(jsonResponse=>{ 
            console.log(jsonResponse); 
            console.log(Number(jsonResponse.date))

            this.setState(()=>{
              return {
                BT:{
                  buy:jsonResponse.ticker.buy,
                  sell:jsonResponse.ticker.sell,
                }
              };
            });
          }) 
      }

      render(){
        return(
          <Table bordered size="sm">
                <thead className="thead-default">
                  <tr>
                    <th scope="col" colSpan="8"><center>入金</center></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th scope="col">幣種</th>
                    <th scope="col">交易所</th>
                    <th scope="col">Qty</th>
                    <th scope="col">買價</th>
                    <th scope="col">匯率</th>
                    <th scope="col">NTD</th>
                    <th scope="col">RMB</th>
                    <th scope="col">USD</th>
                  </tr>
                  <tr>
                    <td>BTC</td>
                    <td>火幣網</td>
                    <td>1</td>
                    <td style={{color:'blue',fontWeight:'bold'}}>{this.state.BT.buy}</td>
                    <td style={{color:'#596043',fontWeight:'bold'}}>{this.props.RMB.avg}</td>
                    <td style={{color:'#596043',fontWeight:'bold'}}>{Math.floor(Number(this.state.BT.buy)*this.props.RMB.avg)}</td>
                    <td>0</td>
                    <td>0</td>
                  </tr>
                </tbody>
          </Table>
        );
      }
    }


    class MaicoinApi extends React.Component{
      constructor(props){
        super(props);
        this.state={
          BT:{
            time:'no start yet',
            high:0,
            low:0,
            buy:0,
            last:0,
            sell:0,
            vol:0
          }
        }
        this.proxyUrl =proxyUrl; 
        this.url = 'https://api.maicoin.com/v1/prices/TWD';
      }

      componentDidMount() {
        this.btcid=setInterval(()=>this.startBTC(),1000);
      }

      componentWillUnmount(){
        clearInterval(this.btcid);
      }

      startBTC(){ 
          fetch(this.proxyUrl +this.url)
          .then(response=>{ 
            if(response.ok){ 
            return response.json(); 
            } 
            throw new Error('Request failed!'); 
          },networkError=>console.log(networkError.message) )
          .then(jsonResponse=>{ 
            console.log(jsonResponse); 

            this.setState(()=>{
              return {
                BT:{
                  sell:jsonResponse.sell_price,
                }
              };
            });
          }) 
      }
      render(){
        return(
          <tr>
              <th scope="row">Maicoin</th>
              <td>1</td>
              <td style={{color:'blue',fontWeight:'bold'}}>{this.state.BT.sell}</td>
              <td style={{color:'#596043',fontWeight:'bold'}}>台銀均價</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
          </tr>
        );
      }
    }

    class BitoexApi extends React.Component{
      constructor(props){
        super(props);
        this.state={
          BT:{
            time:'no start yet',
            high:0,
            low:0,
            buy:0,
            last:0,
            sell:0,
            vol:0
          }
        }
        this.proxyUrl =proxyUrl; 
        this.url = 'https://www.bitoex.com/api/v1/get_rate';
      }

      componentDidMount() {
        this.btcid=setInterval(()=>this.startBTC(),1000);
      }

      componentWillUnmount(){
        clearInterval(this.btcid);
      }

      startBTC(){ 
          fetch(this.proxyUrl +this.url)
          .then(response=>{ 
            if(response.ok){ 
            return response.json(); 
            } 
            throw new Error('Request failed!'); 
          },networkError=>console.log(networkError.message) )
          .then(jsonResponse=>{ 
            console.log(jsonResponse); 

            this.setState(()=>{
              return {
                BT:{
                  sell:jsonResponse.sell,
                }
              };
            });
          }) 
      }
      render(){
        return(
          <tr>
              <th scope="row">Bitoex</th>
              <td>1</td>
              <td style={{color:'blue',fontWeight:'bold'}}>{this.state.BT.sell}</td>
              <td style={{color:'#596043',fontWeight:'bold'}}>台銀均價</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
          </tr>
        );
      }
    }

    class CexioApi extends React.Component{
      constructor(props){
        super(props);
        this.state={
          BT:{
            time:'no start yet',
            high:0,
            low:0,
            buy:0,
            last:0,
            sell:0,
            vol:0
          }
        }
        this.proxyUrl =proxyUrl; 
        this.url = 'https://cex.io/api/ticker/BTC/USD';
      }

      componentDidMount() {
        this.btcid=setInterval(()=>this.startBTC(),1000);
      }

      componentWillUnmount(){
        clearInterval(this.btcid);
      }

      startBTC(){ 
          fetch(this.proxyUrl +this.url)
          .then(response=>{ 
            if(response.ok){ 
            return response.json(); 
            } 
            throw new Error('Request failed!'); 
          },networkError=>console.log(networkError.message) )
          .then(jsonResponse=>{ 
            console.log(jsonResponse); 

            this.setState(()=>{
              return {
                BT:{
                  sell:jsonResponse.ask,
                }
              };
            });
          }) 
      }
      render(){
        return(
          <tr>
              <th scope="row">Cexio</th>
              <td>1</td>
              <td style={{color:'blue',fontWeight:'bold'}}>{this.state.BT.sell}</td>
              <td style={{color:'#596043',fontWeight:'bold'}}>{this.props.USD.avg}</td>
              <td style={{color:'#596043',fontWeight:'bold'}}>{Math.floor(Number(this.state.BT.sell)*this.props.USD.avg)}</td>
              <td>0</td>
              <td>0</td>
          </tr>
        );
      }
    }
    
ReactDOM.render(<App />, document.getElementById('root') );
  </script>
</body>

</html>